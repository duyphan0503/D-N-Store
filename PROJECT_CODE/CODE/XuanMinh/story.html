<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="./images/happy-birthday.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/story.css">
    <title>HAPPY BIRTHDAY</title>
</head>
<body>
    
    <!-- Nhạc -->
    <audio class="song" id="myMusic" loop>
        <source src="hbd.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <div class="box">
        <span style="--i:1;" class="image" data-text="Đón đưa nhau đi học hàng ngày qua con dốc dài, con dốc chất chứa những khoĐón đưa nhau đi học hàng ngày qua con dốc dài, con dốc chất chứa những khoảnh khắc êm đềm của cả một hành trình tình yêu đôi lứa. khắc êm đềm của cả một hành trình tình yêu đôi lứa.">
            <img src="./images/pictures/1.jpg" alt="">
        </span>
        <span style="--i:2;" class="image" data-text="Ba năm cấp 3 trôi qua nhanh như một cơn gió. Cùng nhau trải qua thời khắc quan trọng nhất cuộc đời học sinh.">
            <img src="./images/pictures/2.jpg" alt="">
        </span>
        <span style="--i:3;" class="image" data-text="Những ngày đầu bỡ ngỡ khi mới lên Hà Nội. Hai đứa đầy hứng khởi đi thăm thú nhiều nơi, đưa nhau qua khắp những con phố lớn nhỏ.">
            <img src="./images/pictures/3.jpg" alt="">
        </span>
        <span style="--i:4;" class="image" data-text="Lần đầu đi phượt xe máy cùng với anh chị. Tự tay chuẩn bị đồ ăn, vật dụng cắm trại. Ba Vì vào xuân thật đẹp!">
            <img src="./images/pictures/4.jpg" alt="">
        </span>
        <span style="--i:5;" class="image" data-text="Hồ Tây là địa điểm lượn lờ thường xuyên của 2 đứa, chở nhau đi hết vòng hồ, cùng kể cho nhau nghe những điều thú vị trong cuộc sống.">
            <img src="./images/pictures/5.jpg" alt="">
        </span>
        <span style="--i:6;" class="image" data-text="Đón đưa nhau đi học hàng ngày qua con dốc dài, con dốc chất chứa những khoảnh khắc êm đềm của cả một hành trình tình yêu đôi lứa. 6">
            <img src="./images/pictures/6.jpg" alt="">
        </span>
        <span style="--i:7;" class="image" data-text="Đón đưa nhau đi học hàng ngày qua con dốc dài, con dốc chất chứa những khoảnh khắc êm đềm của cả một hành trình tình yêu đôi lứa. 7">
            <img src="./images/pictures/12.jpg" alt="">
        </span>
        <span style="--i:8;" class="image" data-text="Đón đưa nhau đi học hàng ngày qua con dốc dài, con dốc chất chứa những khoảnh khắc êm đềm của cả một hành trình tình yêu đôi lứa. 8">
            <img src="./images/pictures/8.jpg" alt="">
        </span>
        <span style="--i:9;" class="image" data-text="Đón đưa nhau đi học hàng ngày qua con dốc dài, con dốc chất chứa những khoảnh khắc êm đềm của cả một hành trình tình yêu đôi lứa. 9">
            <img src="./images/pictures/9.jpg" alt="">
        </span>
        <span style="--i:10;" class="image" data-text="Đón đưa nhau đi học hàng ngày qua con dốc dài, con dốc chất chứa những khoảnh khắc êm đềm của cả một hành trình tình yêu đôi lứa. 10">
            <img src="./images/pictures/13.jpg" alt="">
        </span>
    </div>
    
    <!-- Popup -->
    <div class="popup" id="popup">
        <div class="popup-content">
            <p id="popup-text"></p>
            <button id="close-popup">
                <img src="./images/heart_load.png" alt="">
            </button>
        </div>
    </div>
    
    <div class="btnCountdown">
        <img src="./images/cursor.png" id="cursor" alt="">
        <div class="space" style="width: 15px;"></div>
        <img src="./images/heartGift.png" onclick="window.location.href='countdown.html'" id="heart" alt="">
    </div>
    
    <script>
        const images = document.querySelectorAll('.box .image');
        const popup = document.getElementById('popup');
        const popupText = document.getElementById('popup-text');
        const closeButton = document.getElementById('close-popup');

        let typingInterval; 

        images.forEach(image => {
            image.addEventListener('click', () => {
                const text = image.getAttribute('data-text'); 
                resetPopup(); 
                popup.classList.add('show');
                typeText(text); 
            });
        });

        // Hàm chạy từng chữ
        function typeText(text) {
            let index = 0;
            const speed = 100; //(ms)

            // Xóa tiến trình cũ
            clearInterval(typingInterval);

            // Tiến trình typing
            typingInterval = setInterval(() => {
                if (index < text.length) {
                    popupText.innerHTML += text.charAt(index); // Thêm từng chữ 
                    index++;
                } else {
                    clearInterval(typingInterval); // Dừng khi hoàn thành
                }
            }, speed);
        }

        // Hàm đóng popup
        closeButton.addEventListener('click', () => {
            resetPopup(); // Đặt lại trạng thái popup
            popup.classList.remove('show'); // Ẩn popup với hiệu ứng
        });

        // Hàm đặt lại trạng thái popup
        function resetPopup() {
            clearInterval(typingInterval); // Dừng tiến trình typing nếu có
            popupText.innerHTML = ''; // Xóa nội dung văn bản
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            var audio = $('#myMusic')[0];

            // Kiểm tra trạng thái nhạc từ localStorage
            if (localStorage.getItem('musicPlaying') === 'true') {
                var musicTime = localStorage.getItem('musicTime');
                if (musicTime) {
                    // Tiếp tục phát nhạc từ thời điểm đã lưu
                    audio.currentTime = parseFloat(musicTime); // Chuyển đổi chuỗi thành số
                    audio.play();
                }
            }

            // Lưu thời gian phát nhạc hiện tại vào localStorage
            audio.addEventListener('timeupdate', function() {
                localStorage.setItem('musicTime', audio.currentTime);
            });
        });
    </script>

</body>
</html>
